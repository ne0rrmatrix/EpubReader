<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EpubReader.Views.BookPage"
             xmlns:local="clr-namespace:EpubReader.Views"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:viewModels="clr-namespace:EpubReader.ViewModels;assembly=EpubReader"
             x:DataType="viewModels:BookViewModel"
             x:Name="CurrentPage"
             BackgroundColor="White"
             Shell.NavBarIsVisible="{Binding IsNavMenuVisible}"
             Loaded="ContentPage_Loaded">
    
    <ContentPage.ToolbarItems>
        <ToolbarItem
          BindingContext="{Binding Source={x:Reference CurrentPage}, Path=BindingContext, x:DataType=ContentPage}"
          Command="{Binding ShowPopupCommand}"
          IconImageSource="settings.png"
          Order="Primary" />
    </ContentPage.ToolbarItems>

    <Grid  BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundLightColor}, Dark={StaticResource AppBackgroundDarkColor}}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>
        <WebView
                 Grid.Row="0"
                 Scale="1"
                 x:Name="EpubText"
                 VerticalOptions="FillAndExpand" 
                 HorizontalOptions="FillAndExpand" 
                 Navigating="EpubText_Navigating">
            <WebView.GestureRecognizers>
                <OnPlatform x:TypeArguments="SwipeGestureRecognizer">
                    <On Platform="iOS">
                        <SwipeGestureRecognizer Direction="Right,Left" Swiped="SwipeGestureRecognizer_Swiped"/>
                    </On>
                    <On Platform="Android">
                        <SwipeGestureRecognizer Direction="Right,Left" Swiped="SwipeGestureRecognizer_Swiped"/>
                    </On>
                </OnPlatform>
            </WebView.GestureRecognizers>
            <WebView.Behaviors>
                <toolkit:TouchBehavior 
                    BindingContext="{Binding Source={x:Reference CurrentPage}, Path=BindingContext, x:DataType=ContentPage}"
                    LongPressCommand="{Binding LongPressCommand}"/>
            </WebView.Behaviors>
        </WebView>
        <StackLayout
              HorizontalOptions="Center"
              BackgroundColor="{AppThemeBinding Light={StaticResource AppBackgroundLightColor}, Dark={StaticResource AppBackgroundDarkColor}}"
              Grid.Row="1"
              Spacing="50"
              Orientation="Horizontal"
              Padding="10,10,10,10">
            <ImageButton Source="arrow_back.png"
                         IsEnabled="{OnPlatform WinUI=true, Default=false}"
                            IsVisible="{OnPlatform WinUI=true, Default=false}"
                   BackgroundColor="Transparent"
                   Clicked="PreviousPage"
                   WidthRequest="40"/>
            <Label x:Name="PageLabel"
                   FontSize="20"
                   IsVisible="{OnPlatform WinUI=true, Default={Binding IsNavMenuVisible}}"
                   HorizontalOptions="Center"/>
            <ImageButton Source="arrow_forward.png"
                         IsEnabled="{OnPlatform WinUI=true, Default=false}"
                         IsVisible="{OnPlatform WinUI=true, Default=false}"
                   BackgroundColor="Transparent"
                   Clicked="NextPage"
                   WidthRequest="40"/>
        </StackLayout>
    </Grid>
</ContentPage>