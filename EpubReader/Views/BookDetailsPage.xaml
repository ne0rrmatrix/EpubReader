<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="EpubReader.Views.BookDetailsPage"
    xmlns:ffimageloading="clr-namespace:FFImageLoading.Maui;assembly=FFImageLoading.Maui"
    Padding="12"
    x:DataType="BookDetailsViewModel"
    Shell.BackgroundColor="{AppThemeBinding Dark={StaticResource AppBackgroundDarkColor},
                                            Light={StaticResource Blue200Accent}}">

    <ContentPage.ToolbarItems>
        <ToolbarItem
            Command="{Binding Source={RelativeSource AncestorType={x:Type BookDetailsViewModel}}, Path=CalibreCommand}"
            IconImageSource="globe_book_24dp.png"
            Order="Primary" />
        <ToolbarItem
            Command="{Binding Source={RelativeSource AncestorType={x:Type BookDetailsViewModel}}, Path=SettingsCommand}"
            IconImageSource="{AppThemeBinding Light={OnPlatform WinUI=settings_darkmode.png,
                                                                Default=settings_lightmode.png},
                                              Dark=settings_lightmode.png}"
            Order="Primary" />
    </ContentPage.ToolbarItems>

    <Grid HorizontalOptions="Center" VerticalOptions="Center">
        <ScrollView>
            <!--  Container that holds both Phone-only single-column layout and the two-column layout for Tablet/Desktop  -->
            <Grid Padding="6" HorizontalOptions="Center">

                <!--  Phone single-column layout: Title, Image, Button, Description  -->
                <VerticalStackLayout
                    Padding="0"
                    IsVisible="{OnIdiom Phone=true,
                                        Tablet=false,
                                        Desktop=false}"
                    Spacing="10">
                    <Label
                        FontAttributes="Bold"
                        FontSize="{OnIdiom Phone=20,
                                           Tablet=24,
                                           Desktop=28}"
                        LineBreakMode="TailTruncation"
                        Text="{Binding Book.Title}" />

                    <ffimageloading:CachedImage
                        Aspect="AspectFit"
                        HeightRequest="{OnIdiom Phone=260,
                                                Tablet=340,
                                                Desktop=420}"
                        HorizontalOptions="Center"
                        Source="{Binding CoverImage}"
                        WidthRequest="{OnIdiom Phone=160,
                                               Tablet=220,
                                               Desktop=300}" />

                    <Button
                        Command="{Binding ReadCommand}"
                        FontSize="{OnIdiom Phone=14,
                                           Tablet=16,
                                           Desktop=16}"
                        HorizontalOptions="Center"
                        Text="Read" />

                    <Label
                        FontAttributes="Bold"
                        FontSize="{OnIdiom Phone=16,
                                           Tablet=18,
                                           Desktop=20}"
                        Text="Description" />
                    <Label
                        FontSize="{OnIdiom Phone=14,
                                           Tablet=16,
                                           Desktop=18}"
                        LineBreakMode="WordWrap"
                        Text="{Binding Book.Description}"
                        TextType="Html" />
                </VerticalStackLayout>

                <!--  Two-column layout for Tablet and Desktop  -->
                <Grid
                    ColumnDefinitions="Auto,*"
                    ColumnSpacing="20"
                    IsVisible="{OnIdiom Phone=false,
                                        Tablet=true,
                                        Desktop=true}"
                    RowDefinitions="Auto,Auto">

                    <!--  Cover image column  -->
                    <Frame
                        Grid.Row="1"
                        Grid.Column="0"
                        Padding="6"
                        BorderColor="Transparent"
                        HasShadow="False"
                        VerticalOptions="Start">
                        <ffimageloading:CachedImage
                            Aspect="AspectFit"
                            HeightRequest="{OnIdiom Phone=260,
                                                    Tablet=340,
                                                    Desktop=420}"
                            HorizontalOptions="Center"
                            Source="{Binding CoverImage}"
                            VerticalOptions="Start"
                            WidthRequest="{OnIdiom Phone=160,
                                                   Tablet=220,
                                                   Desktop=300}" />
                    </Frame>

                    <!--  Details column  -->
                    <Grid Grid.Row="1" Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <VerticalStackLayout Padding="0,4,0,8" Spacing="6">
                            <Label
                                FontAttributes="Bold"
                                FontSize="{OnIdiom Phone=20,
                                                   Tablet=24,
                                                   Desktop=28}"
                                LineBreakMode="TailTruncation"
                                Text="{Binding Book.Title}" />

                            <HorizontalStackLayout Spacing="10">
                                <Label
                                    FontSize="{OnIdiom Phone=13,
                                                       Tablet=15,
                                                       Desktop=17}"
                                    Text="{Binding Book.Author}"
                                    TextColor="Gray" />
                                <Label Text="â€¢" TextColor="Gray" />
                                <Label
                                    FontSize="{OnIdiom Phone=12,
                                                       Tablet=14,
                                                       Desktop=16}"
                                    Text="{Binding Book.Date}"
                                    TextColor="Gray" />
                            </HorizontalStackLayout>

                            <Button
                                Command="{Binding ReadCommand}"
                                FontSize="{OnIdiom Phone=14,
                                                   Tablet=16,
                                                   Desktop=16}"
                                HorizontalOptions="Start"
                                Text="Read" />
                        </VerticalStackLayout>

                        <StackLayout Grid.Row="1" Padding="0,6,0,0">
                            <Label
                                FontAttributes="Bold"
                                FontSize="{OnIdiom Phone=16,
                                                   Tablet=18,
                                                   Desktop=20}"
                                Text="Description" />
                            <Label
                                FontSize="{OnIdiom Phone=14,
                                                   Tablet=16,
                                                   Desktop=18}"
                                LineBreakMode="WordWrap"
                                Text="{Binding Book.Description}"
                                TextType="Html" />
                        </StackLayout>
                    </Grid>
                </Grid>

            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>
